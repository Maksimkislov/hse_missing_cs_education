# Безопасность и приватность

## Безопасность

Это всегда вопрос про доверие, и технологии лишь позволяют Вам проверить, что
некоторые свойства безопасности гарантируются. Уровень доверия снижается где-то
в последовательности "я, семья, партнер, предмет быта, телефон, прохожий, сеть, убийца."
Как самый банальный пример: к Вам может ворваться грабитель и взломать Ваш замок.
Почему так не происходит часто? Если убрать социальные причины, одна из
причин &mdash; замки взламывать становится сложнее из-за сложности конструкций,
или непрактично подделывать ключи, люди могут заметить взломщиков.

С безопасностью в интернете примерно так же, только теперь мы пытаемся сделать
так, чтобы другие компьютеры нас не смогли взломать (а точнее их мощностей не
хватит). Из хороших новостей, с которыми Вы скорее всего как-то сталкивались
на алгоритмах:

* Нам сложно решать NP-полные задачи
* Как числовой пример, нам сложно факторизовать числа
* Нам сложно перебирать

Это лишь говорит о том, что если кто-то научится решать проблему из
вышеперечисленных эффективно, они получат намного больше, чем взлом Вашего
пароля в ВКонтакте. Банковская, ядерная система рухнет и в целом можно
начать апокалипсис, если кто-то решит любую из трёх задач выше.

## Пароли

Если рассматривать односторонние пароли, то самое важное понятие, которым
надо руководствоваться &mdash; сколько злоумышленнику потребуется времени, чтобы
его перебрать. Математическое понятие &mdash; энтропия. Фактически,
логарифм количества вариантов. На этот счёт есть хороший комикс:

![XKCD](https://imgs.xkcd.com/comics/password_strength.png)

Почти любой может перебрать пароли с энтропией 25-30. Это всего какие-то жалкие
миллиарды операций. Уже намного сложнее с энтропией 50-60, для этого потребуется
много мощностей. Представим, что злоумышленник может перебирать 100 миллиардов
в секунду &mdash; это где-то 30-50 мощных комп станций или 10-20 приличных
серверов. Пароли из больших и маленьких букв + цифр, алфавит 62 символа:

* 6 символов. 0.5 секунд, энтропия 35
* 8 символов. 37 минут, энтропия 47
* 9 символов. 1.5 дня, энтропия 53
* 10 символов. 3.25 месяцев, энтропия 59
* 11 символов. 17 **лет**, энтропия 65
* 12 символов. 10.5 **столетий**, энтропия 71

Дальше экспоненциально, понятное дело. Поиграться можно
[здесь](https://www.grc.com/haystack.htm). Де факто даже энтропию 40-50 уже
сложно перебирать, особенно в онлайне, но оно находится на грани текущих
возможностей, желаний и эффективности.

Если не рассматривать квантовые компьютеры, перебор пароля с энтропией 60-70
занимает огромное количество ресурсов и практически невозможен, если не задействует
десятки миллионы долларов для вычислений.

Главное, не повторяться и генерировать их случайно для тех сайтов, на которых
Вам не надо часто делать логин. Для этого существуют парольные менеджеры.
KeePass, LastPass, 1Password, все из них хороши. Вы можете спросить, не
является ли это проблемой курицы и яйца? Является. Сгенерируйте один
пароль, который написан на бумажке для этих парольных менеджеров. Если Вы его
забудете, будет плохо, конечно, если у Вас его украдут, тоже будет плохо (см. про
доверие к себе), если украдут что угодно остальное, то будет ещё неплохо.
Например, даже если какой-то сайт взломали и все пароли вытащили, Вы можете быть
уверенными, что другие сайты не взломают с Вашим логином.

Эту цепочку можно раскручивать очень далеко и можно стать параноиком, что за
Вами следят. Это уже Вам решать, какой уровень доверия Вы себе позволяете. Я
лично считаю, что надо обеспечивать безопасность Выше среднего, доверять одному
паролю для менеджера паролей можно, энтропия 70 максимально сложна, вебкамеры не
следят, конспирологии в бизнесе не существует, таргетированный взлом редок и Вы
скорее сами поймёте, если Вас хотят взломать, массовые взломы подвергаются
огромному резонансу, доверять вебу надо аккуратно, но тоже не супер сложно.
В любом случае:

![XKCD2](https://imgs.xkcd.com/comics/security.png)

Там, где нужен частый логин, например, `sudo` на машине, используйте
тактику, которая указана в первом комиксе: генерация 4-5 слов, каждое привносит
энтропию 11 (из 2048 часто встречающихся слов), поэтому перебрать будет сложно
44-55 энтропийные пароли. Для генерации можно воспользоваться
[этим сайтом](https://xkpasswd.net/s/) или написать программу самим :).

Смотрите конец лекции, если хотите узнать, чем пользуется лектор.

## Хэширование

[Криптографические функции](https://en.wikipedia.org/wiki/Cryptographic_hash_function) берут какой-то кусок данных (может быть большой) и превращают его в вектор байт хэша, которые удовлетворяют некоторым свойствам.

Пример одной из такой функции является [SHA1](https://en.wikipedia.org/wiki/SHA-1), которая используется в git. Она берёт любые входные данные и выдаёт 160 бит хэша (что является 40 байтным 16-ричной строкой)

```console
$ printf 'hello' | sha1sum
aaf4c61ddcc5e8a2dabede0f3b482cd9aea9434d
$ printf 'hello' | sha1sum
aaf4c61ddcc5e8a2dabede0f3b482cd9aea9434d
$ printf 'Hello' | sha1sum
f7ff9e8b7bb2e09b70935a5d785e0cc5d9d0abf0
```

На очень высоком уровне можно считать, что такие хэш-функции очень сложно инвертировать (по данному хэшу продемонстрировать данные). Криптографические хэши в целом должны удовлетворять следующим свойствам, которые более подробно разделяют [по уровням](http://nohatcoder.dk/2019-05-19-1.html):

* Детерминированность. По одиковым входам одинаковые выходы
* Если дан хэш с N битами, то надо порядка 2^N операций, чтобы найти вход, у которого такой хэш
* Если дан вход `m_1`, то надо порядка 2^N операций, чтобы найти другой вход `m_2`, у которого такой же хэш
* Нужно порядка 2^(N/2) операций, чтобы найти два различных входа `m_1` и `m_2`, у которых совпадают хэши (вспоминайте парадокс дней рождения)

Стоит отметить, что SHA-1 уже не [сильный хэш](https://shattered.io/). Вы можете найти интересным таблицу: какие уязвимости находили в криптографических хэшах в каких годах [по ссылке](https://valerieaurora.org/hash.html).

Анализ уязвимостей хешей всегда занимательно читать, например, прочитайте как в [Meow hash](https://peter.website/meow-hash-cryptanalysis) были анализированы большие уязвимости.

## Шифрование

Конечно, Вы можете шифровать всё с одним паролем и хранить его на бумажке. К
сожалению, это не решает задачу, если Вы хотите с кем-то очень секретно
пообщаться. Кто-то другой должен знать Ваш пароль, чтобы читать Ваши сообщения.
Это не дело, пароль должны по-хорошему знать только Вы. Если говорить в терминах
безопасности, выше было описано одностороннее симметричное шифрование.

```
keygen() -> key  (this function is randomized)

encrypt(plaintext: array<byte>, key) -> array<byte>  (the ciphertext)
decrypt(ciphertext: array<byte>, key) -> array<byte>  (the plaintext)
```

Есть ассиметричное, которое позволяет только Вам общаться и никто посередине не
поймёт, о чём. Предотвращает атаки MITM или Man In The Middle в терминах
безопасности, если Вы смогли публичный ключ доверительно отослать (например,
Ваш провайдер может подменять все сайты, см. пункт про доверие :-)).

Для этого нужно сгенерировать два ключа: приватный и публичный. Публичный
доступен всем, приватный только Вам. Считайте их
простыми числами, тогда Вы можете кодировать сообщения с помощью приватного
ключа (подпись), а другие его могут раскодировать Вашим публичным и подтверждать, что Вы это Вы. Наоборот &mdash; все
другие кодируют Вашим публичным, а Вы раскодируйте Вашим приватным. Если хотите
понять как оно математически работает, почитайте про [RSA](https://en.wikipedia.org/wiki/RSA_(cryptosystem)).
Если коротко, возведения в степень по модулю очень сложно раскодировать, потому
что очень сложно факторизовать числа.

```
keygen() -> (public key, private key)  (this function is randomized)

encrypt(plaintext: array<byte>, public key) -> array<byte>  (the ciphertext)
decrypt(ciphertext: array<byte>, private key) -> array<byte>  (the plaintext)

sign(message: array<byte>, private key) -> array<byte>  (the signature)
verify(message: array<byte>, signature: array<byte>, public key) -> bool  (whether or not the signature is valid)
```

По такому шифрованию работает https, где сертификаты сайтам выдают агентства,
которым доверяют. И дальше они спокойно кодируют сообщения с ключами с обеих
сторон.

Так ещё работает ssh (secure shell, a.k.a. заход на другие машины):

Чтобы сгенерировать ключи, надо воспользоваться `ssh-keygen`:

```console
$ ssh-keygen
```

Дальше Вы просто делитесь публичным ключём с кем угодно, а приватный находится
у Вас. Нормально делиться своим публичным ключём со многими другими.
Пока Вы гарантируете сохранность приватного ключа, безопасность "гарантируется".

Похожим образом работают транзакции в банковской системе, но мы оставляем это
за пределами нашего обсуждения.

Так работает end-to-end с некоторыми наворотами, которые позволяют создавать
общий секрет только между двумя сущностями с алгоритмом [Diffie-Hellman](https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange). Так отчасти работают секретные чаты в Телеграм и
совпадение картинки гарантирует, что канал установлен и никто не слушает Вас.
Конечно, если картинка отражает действительно общий ключ. Чтобы избежать хранения
ключей на серверах, возникают проблемы с синхронизацией между устройствами, но
эта тема тоже вне нашего обсуждения сегодня.

## Анонимность

Есть VPN, Tor, первый пытается использовать proxy, чтобы Ваш IP адрес
невозможно было отследить, но Вы должны сильно доверять VPN провайдеру. Tor
создаёт отдельную сеть, где через каждого участника можно "прыгать" и тем самым
путать свои пути к точке выхода. Оба увеличивают Вашу анонимность, но даже они
уязвимы к атакам sniff: когда отслеживают выход и вход и пытаются провести
корреляцию. Такие атаки вполне успешны и с ними фундаментально ничего не
поделать.

В целом есть ощущение, что мир всё менее приватен, так как даже по Вашим
запросам в Google можно достаточно точно описать, кто Вы как личность. А вот
безопасность растёт и возможна. Хранить секреты текущие технологии умеют
достаточно хорошо.

## Телефоны

Любой баг в ядре ведет к тому, что телефон можно взломать, к сожалению.
Обновляйте свои телефоны часто. Тут Apple впереди из-за принудительности. Из
линейки Android только Pixel может похвастаться такой же скоростью.

## SMS

GSM сети &mdash; одни из самых небезопасных протоколов в мире, который ещё и сложно
поменять. Не пользуйтесь им, в том числе и для двухфакторной аутентификации, прочитайте про [SMS spoofing](https://en.wikipedia.org/wiki/SMS_spoofing).

## Two-factor

Основная суть двухфакторной аутентификации &mdash; спросить другой ресурс, а
точно ли это Вы. Самый простой пример: "Вы говорите маме, что гуляете с друзьями,
она просит дать телефон другу, чтобы подтвердить, что это так".

Используйте 2Auth только с [Auth apps](https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&hl=en_GB&gl=US), которые
перегенерируют коды раз в несколько секунд и достаточно сложны для взламывания.
SMS и телефоны менее безопасны и вполне могут подделываться.

YubiKey предотвращает вход на определенные сети (по факту, любые действия,
даже заход по ssh или чтение файла можно настроить) без подтверждения, что Вы
дотронулись до нужного ключа. Протокол открыт и всем понятен, подделать реальное
нажатие на ключ крайне сложно. Например, количество фишинговых атак на Google
после перевода всех сотрудников на YubiKey снизилось до нуля.

## WiFi

Старайтесь не подключаться к публичным точкам WiFi, они сделаны так, что
запоминание идёт по именам точек и их легко подделать. Приватные WiFi точки
достаточно безопасны.

## Чем пользуется лектор в 2020 году

* [KeePass](https://keepassxc.org/) для хранения паролей, некоторые для
  синхронизации на многих устройствах используют
  [LastPass](https://www.lastpass.com/)
* [Yubikey](https://www.yubico.com/)  для предотвращения фишинговых атак на себя
* [NordVPN](https://nordvpn.com/), если мне нужен VPN
* [Tor](https://www.torproject.org/)  в научных целях, как говорилось на лекции,
  он всё равно уязвим к атакам sniff
* [Ublock Origin](https://chrome.google.com/webstore/detail/ublock-origin/cjpalhdlnbpafiamejdnhcphjbkeiagm?hl=en)
  для блокирования рекламы и блокирования входа на плохие сайты.
* [HTTPS Everywhere](https://chrome.google.com/webstore/detail/https-everywhere/gcbommkclmclpchllfjekcdonpmejbdp?hl=en)
  для предотвращения захода на сайты с чистым http или протухшим сертификатом
* Arch Linux (хотя эксперты по безопасности его ругают немного и советуют
  Fedora) вместе с [LUKS](https://wiki.archlinux.org/index.php/Dm-crypt/Encrypting_an_entire_system)
  для шифрования диска
* Google Pixel 3 — из-за последних security патчей и андройда, остальные вендоры
  не любят патчи от Google по странным причинам, хотя они действительно полезны.
  Как мы говорили, Apple тут впереди из-за принудительного обновления своего ПО
* Не использую публичные WiFi и кабели в аэропортах, если я еду куда-то в
  роуминг, то покупаю [eSIM](https://en.wikipedia.org/wiki/ESIM) c
  [AirAlo](https://www.airalo.com/), не все телефоны это поддерживают, но всё же
* Двух-факторная аутентификация только вместе с [Authentificator
  App](https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&hl=en_GB&gl=US),
  никаких SMS
* [pass](https://wiki.archlinux.org/index.php/Pass) утилитка для шифрования
  своих файлов, если надо их загрузить в облако (например, фотку паспорта)
* Настраиваю свой WiFi, чтобы только мои Mac адреса могли к нему подключаться —
  но, к сожалению, Mac адреса тоже можно имперсонировать
* Отпечатки пальцев неплохие, но уязвимы к атакам, если вы эти отпечатки где-то
  оставляете, например, даже в кафе.

Если Вы хотите ультимативный гайд, то можете прочитать [эту заметку](https://techsolidarity.org/resources/basic_security.htm) для журналистов в США, которые ездят в ближний восток для репортажей. Если кратко:

всё выше перечисленное + Chromebook + Signal/WhatsApp (никаких Telegram),
Windows Defender и никаких антивирусов + только IPhone и закленные веб камеры.
